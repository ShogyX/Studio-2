<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}"> <!-- This grabs the CSS stylesheet from the Static folder -->
    <title>Password Strength Meter 3000</title>
</head>


<body>
    
    <div class="container">
        <div class="second-container">
            <div>
                <span id="uppercase">Uppecase</span>
            </div>
            <div>
                <span id="lowercase">Lowercase</span>
            </div>
            <div>
                <span id="numbers">Integers</span>
            </div>
            <div>
                <span id="special">Special Characters</span>
            </div>
        </div>
        <h1>Super PSM 3000</h1>
        <div class="input-container">
            <div class="password-input-container">
                <input id="input_text" type="password" placeholder="Enter your password" oninput="checkPasswordStrength(this.value)">
                <span class="password-toggle-icon" onclick="togglePasswordVisibility()">
                    <i class="fas fa-eye"></i>
                </span>
            </div>
            <button id="analyze_button" onclick="analyzePassword()">Analyze</button>
        </div>

        
            <div class="meter-container">
                <div class="progress-circle">
                    <svg class="progress-circle__svg" viewBox="0 0 100 100">
                    <circle class="progress-circle__background" cx="50" cy="50" r="45"></circle>
                    <circle class="progress-circle__progress" cx="50" cy="50" r="45"></circle>
                    <text class="progress-circle__text" x="50" y="50" text-anchor="middle" alignment-baseline="middle"></text>
                    </svg>
                </div>
                </div>
        <div class="info-box-container" id="info-box-container">
        </div>

        <div id="placeholder-box" class="info-box placeholder-box">
            <div class="placeholder-info-box-title">Currently Downloading More RAM</div>
            <div class="placeholder-info-box-message">Installing CPU</div>
        </div>

        

        <div class="loading-overlay" id="loading-overlay">
            <div class="loader"></div>
    </div>

    

    <script>
        setProgress(0);
        infoBoxContainer.innerHTML = "";
        
        function togglePasswordVisibility() {
            var passwordField = document.getElementById("input_text");
            var icon = document.querySelector(".password-toggle-icon i");
            if (passwordField.type === "password") {
                passwordField.type = "text";
                icon.classList.remove("fa-eye");
                icon.classList.add("fa-eye-slash");
            } else {
                passwordField.type = "password";
                icon.classList.remove("fa-eye-slash");
                icon.classList.add("fa-eye");
            }
        }

        function checkPasswordStrength(password) {
            var uppercaseRegex = /[A-Z]/;
            var lowercaseRegex = /[a-z]/;
            var numberRegex = /[0-9]/;
            var specialRegex = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/;

            var uppercaseDiv = document.getElementById('uppercase');
            var lowercaseDiv = document.getElementById('lowercase');
            var numbersDiv = document.getElementById('numbers');
            var specialDiv = document.getElementById('special');

            uppercaseDiv.style.color = uppercaseRegex.test(password) ? 'green' : 'red';
            lowercaseDiv.style.color = lowercaseRegex.test(password) ? 'green' : 'red';
            numbersDiv.style.color = numberRegex.test(password) ? 'green' : 'red';
            specialDiv.style.color = specialRegex.test(password) ? 'green' : 'red';
        }

        document.getElementById("input_text").addEventListener("keyup", function(event) {
            // Check if the Enter key (key code 13) is pressed
            if (event.keyCode === 13) {
                // Prevent the default action of the Enter key (form submission)
                event.preventDefault();
                // Call the analyzePassword() function
                analyzePassword();
            }
        });

        function cleanInput(input) {
            // Regular expression to match any escaped characters
            var escapedRegex = /\\[0-9A-Fa-f]{1,2}/g;
        
            // Replace escaped characters with an empty string
            return input.replace(escapedRegex, '');
        }

        function setProgress(percent) {
        const circle = document.querySelector('.progress-circle__progress');
        const text = document.querySelector('.progress-circle__text');
        const radius = circle.r.baseVal.value;
        const circumference = 2 * Math.PI * radius;
        const offset = circumference - (percent / 100) * circumference;
        circle.style.strokeDashoffset = offset;
        // Set color based on progress
        const color = getColor(percent);
        circle.style.stroke = color;
        text.textContent = percent + '%';
        text.style.fill = color;
        }

        function getColor(percent) {
        // Define color intervals
        const colorIntervals = [
            { start: 0, end: 25, color: '#FF4500' }, // Red
            { start: 25, end: 50, color: '#FFA500' }, // Orange
            { start: 50, end: 75, color: '#FFFF00' }, // Yellow
            { start: 75, end: 100, color: '#32CD32' } // Green
        ];

        // Find the color interval for the given percentage
        for (const interval of colorIntervals) {
            if (percent >= interval.start && percent <= interval.end) {
            return interval.color;
            }
        }
        }
        
        function positionLoader() {
            var infoBoxContainer = document.getElementById('info-box-container');
            var loader = document.querySelector('.loader');

            // Calculate the position of the loader
            var containerRect = infoBoxContainer.getBoundingClientRect();
            var loaderWidth = loader.offsetWidth;
            var loaderHeight = loader.offsetHeight;
            var loaderTop = containerRect.top + (containerRect.height / 2) - (loaderHeight / 2);
            var loaderLeft = containerRect.left + (containerRect.width / 2) - (loaderWidth / 2);

            // Set the position of the loader
            loader.style.top = loaderTop + 'px';
            loader.style.left = loaderLeft + 'px';
        }

        function showLoading() {
            positionLoader();
            document.getElementById("loading-overlay").style.display = "block";
        }

        function hideLoading() {
            document.getElementById("loading-overlay").style.display = "none";
            
        }

        function analyzePassword() {
            showLoading();
            var passwordField = document.getElementById("input_text").value;
            var infoBoxContainer = document.getElementById("info-box-container");
            
            fetch('/analyze', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'input_text=' + encodeURIComponent(passwordField),
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                infoBoxContainer.innerHTML = "";
                createInfoBoxes(data);
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        function createInfoBoxes(data) {
            var container = document.getElementById('info-box-container');
            // Hide the placeholder box
            var placeholderBox = document.getElementById('placeholder-box');
            placeholderBox.style.display = 'none'
            // Loop through each key in the JSON
            for (var key in data) {
                
                if (key !== 'Issues Found') {
                    var messages = data[key];
                    if (messages.length > 0) {
                        // Create information box
                        var infoBox = document.createElement('div');
                        infoBox.classList.add('info-box');

                        // Set title
                        var title = document.createElement('div');
                        title.classList.add('info-box-title');
                        title.textContent = key;
                        infoBox.appendChild(title);

                        // Set messages
                        messages.forEach(function(message) {
                            var messageElement = document.createElement('div');
                            messageElement.classList.add('info-box-message');
                            messageElement.textContent = message;
                            infoBox.appendChild(messageElement);
                        });

                        // Append information box to container
                        container.appendChild(infoBox);

                    }
                }
                if (key === 'Issues Found') {
                    var issuesFound = data[key]; // Assuming 'issuesFound' is the variable to store the number of issues found
                    if (issuesFound === 0) {
                        setProgress(100);
                        // Create an information box
                        var infoBox = document.createElement('div');
                        infoBox.classList.add('info-box');

                        // Set title
                        var title = document.createElement('div');
                        title.classList.add('info-box-title');
                        title.textContent = 'No issues found';
                        infoBox.appendChild(title);

                        // Create a message box
                        var messageBox = document.createElement('div');
                        messageBox.classList.add('info-box-message');
                        messageBox.textContent = 'Congratulations! We cant find any common fallacies in your password. We still recommend testing the password on other PSM sites to ensure the password is strong enough';
                        infoBox.appendChild(messageBox);

                        // Append information box to regular container
                        var container = document.getElementById('info-box-container');
                        container.appendChild(infoBox);
                        
                        // Hide the placeholder box
                        var placeholderBox = document.getElementById('placeholder-box');
                        placeholderBox.style.display = 'none';

                        // Change the color of the info box elements
                        
                        var infoBoxTitle = document.querySelector('.info-box-title');
                        infoBoxTitle.style.backgroundColor = '#32CD32'; // Green background color

                        var infoBoxMessage = document.querySelector('.info-box-message');
                        infoBoxMessage.style.backgroundColor = '#5CCD6F'; // Light green background color


                    } else if (issuesFound === 1) {
                        setProgress(90);
                    } else if (issuesFound === 2) {
                        setProgress(75);
                    } else if (issuesFound === 3) {
                        setProgress(50);
                    } else if (issuesFound === 4) {
                        setProgress(25);
                    } else if (issuesFound === 5) {
                        // Set progress to a value appropriate for 5 issues found
                        setProgress(someValue);
                    } else {
                        setProgress(0);
                    }
                }
            }
            // Show the info box container
            container.style.display = 'block';

            
        }

    </script>
</body>
</html>
