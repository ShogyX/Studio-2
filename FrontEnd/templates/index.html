<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}"> <!-- This grabs the CSS stylesheet from the Static folder -->
    <title>Password Strength Meter 3000</title>
</head>


<body>
    <div class="container">
        <h1>Super PSM 3000</h1>
        <div class="input-container">
            <div class="password-input-container">
                <input id="input_text" type="password" placeholder="Enter your password" oninput="checkPasswordStrength(this.value)">
                <span class="password-toggle-icon" onclick="togglePasswordVisibility()">
                    <i class="fas fa-eye"></i>
                </span>
            </div>
            <button id="analyze_button" onclick="analyzePassword()">Analyze</button>
        </div>
        <div id="analysis_result">
            <div>
                <span id="uppercase">Uppecase</span>
            </div>
            <div>
                <span id="lowercase">Lowercase</span>
            </div>
            <div>
                <span id="numbers">Integers</span>
            </div>
            <div>
                <span id="special">Special-Characters</span>
            </div>

        <div class="meter-container">
            <div class="progress-circle">
                <svg class="progress-circle__svg" viewBox="0 0 100 100">
                  <circle class="progress-circle__background" cx="50" cy="50" r="45"></circle>
                  <circle class="progress-circle__progress" cx="50" cy="50" r="45"></circle>
                  <text class="progress-circle__text" x="50" y="50" text-anchor="middle" alignment-baseline="middle"></text>
                </svg>
              </div>
            </div>
        </div>
    </div>
    <div class="feedback-container">

    </div>



    <script>

        function togglePasswordVisibility() {
            var passwordField = document.getElementById("input_text");
            var icon = document.querySelector(".password-toggle-icon i");
            if (passwordField.type === "password") {
                passwordField.type = "text";
                icon.classList.remove("fa-eye");
                icon.classList.add("fa-eye-slash");
            } else {
                passwordField.type = "password";
                icon.classList.remove("fa-eye-slash");
                icon.classList.add("fa-eye");
            }
        }

        function checkPasswordStrength(password) {
            var uppercaseRegex = /[A-Z]/;
            var lowercaseRegex = /[a-z]/;
            var numberRegex = /[0-9]/;
            var specialRegex = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/;

            var uppercaseDiv = document.getElementById('uppercase');
            var lowercaseDiv = document.getElementById('lowercase');
            var numbersDiv = document.getElementById('numbers');
            var specialDiv = document.getElementById('special');

            uppercaseDiv.style.color = uppercaseRegex.test(password) ? 'green' : 'red';
            lowercaseDiv.style.color = lowercaseRegex.test(password) ? 'green' : 'red';
            numbersDiv.style.color = numberRegex.test(password) ? 'green' : 'red';
            specialDiv.style.color = specialRegex.test(password) ? 'green' : 'red';
        }

        document.getElementById("input_text").addEventListener("keyup", function(event) {
            // Check if the Enter key (key code 13) is pressed
            if (event.keyCode === 13) {
                // Prevent the default action of the Enter key (form submission)
                event.preventDefault();
                // Call the analyzePassword() function
                analyzePassword();
            }
        });

        function setProgress(percent) {
        const circle = document.querySelector('.progress-circle__progress');
        const text = document.querySelector('.progress-circle__text');
        const radius = circle.r.baseVal.value;
        const circumference = 2 * Math.PI * radius;
        const offset = circumference - (percent / 100) * circumference;
        circle.style.strokeDashoffset = offset;
        // Set color based on progress
        const color = getColor(percent);
        circle.style.stroke = color;
        text.textContent = percent + '%';
        text.style.fill = color;
        }

        function getColor(percent) {
        // Define color intervals
        const colorIntervals = [
            { start: 0, end: 25, color: '#FF4500' }, // Red
            { start: 25, end: 50, color: '#FFA500' }, // Orange
            { start: 50, end: 75, color: '#FFFF00' }, // Yellow
            { start: 75, end: 100, color: '#32CD32' } // Green
        ];

        // Find the color interval for the given percentage
        for (const interval of colorIntervals) {
            if (percent >= interval.start && percent <= interval.end) {
            return interval.color;
            }
        }
        }
        
        function analyzePassword() {
            var passwordField = document.getElementById("input_text").value;
            var strengthIndicator = document.getElementById("analysis_result");
            var feedbackContainer = document.getElementById("feedback");
            
            fetch('/analyze', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'input_text=' + encodeURIComponent(passwordField),
            })
            .then(response => response.json())
            .then(data => {
                updateFeedbackContainer(data);

                if (data.Strength === 'Strong') {
                    setProgress(100);
                } else if (data.Strength === 'Moderate') {
                    setProgress(50);
                } else {
                    setProgress(25);
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        function updateFeedbackContainer(data) {
            var feedbackContainer = document.querySelector(".feedback-container");

            // Clear previous content
            feedbackContainer.innerHTML = "";

            // Display password strength
            var strengthParagraph = document.createElement("p");
            strengthParagraph.textContent = "Password Strength: " + data.Strength;
            feedbackContainer.appendChild(strengthParagraph);

            // Display feedback
            var feedbackParagraph = document.createElement("p");
            feedbackParagraph.textContent = "Feedback: " + data.Feedback;
            feedbackContainer.appendChild(feedbackParagraph);

            // Display detailed analysis result
            var analysisDetails = data.AnalysisDetails;
            if (analysisDetails) {
                var detailsHeading = document.createElement("h3");
                detailsHeading.textContent = "Analysis Details:";
                feedbackContainer.appendChild(detailsHeading);

                var detailsList = document.createElement("ul");
                feedbackContainer.appendChild(detailsList);

                for (var key in analysisDetails) {
                    var detailItem = document.createElement("li");
                    detailItem.textContent = key + ": " + analysisDetails[key];
                    detailsList.appendChild(detailItem);
                }
            }

            if (data.Strength === "Weak") {
                feedbackContainer.classList.add("weak");
            } else if (data.Strength === "Moderate") {
                feedbackContainer.classList.add("moderate");
            } else if (data.Strength === "Strong") {
                feedbackContainer.classList.add("strong");
            }
        }


    </script>
</body>
</html>
